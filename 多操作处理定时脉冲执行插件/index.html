<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
		<button onclick="test3.add()">add</button>
		<button onclick="test3.del()">del</button>
		<button onclick="test3.up()">update</button>
	</body>
	<script>
		function TimerRuner(delay){
			
			this.delay=delay||1000;
			this.runing=false;
			this.timeFuns=[];
		
			this.run=function(){
				var timeFun;
				var that=this;
				for(var l=0;timeFun=this.timeFuns[l];l++){
					timeFun();
				}
				setTimeout(function(){
					if(that.runing) that.run();
				},this.delay);
			};
		}
		TimerRuner.prototype={
			//添加脉冲事件
			addTimeFun:function(timefun){
				this.timeFuns.push(timefun);
			},
			//添加激发事件
			addActiveFun:function(name,fun){
				if(this[name]){
					console.error("there has a function named"+name+"！！");
					return;
				}
				this[name]=function(){
					fun();
					if(this.runing) return;
					this.runing=true;
					this.run();
				}
			},
			//设置触发间隔时间
			setDelay:function(_delay){
				this.delay=_delay;
			},
			//手动控制
			stop:function(){
				this.runing=false;
			},
			start:function(){
				this.runing=true;
				this.run();
			},
		};
		
		var test=new TimerRuner(1000);
		test.addActiveFun("add",function(){
			console.log("add");
		});
		test.addActiveFun("del",function(){
			console.log("del");
		});
		test.addActiveFun("up",function(){
			console.log("up");
		});
		
		test.addTimeFun(function(){
			console.log("haha");
		});
		
		test.setDelay(1000);
		
		function test2(){};
		test2.prototype=new TimerRuner();
		
	
		var test3=new test2();
		
		test3.addActiveFun("add",function(){
			console.log("add");
		});
		test3.addActiveFun("del",function(){
			console.log("del");
		});
		test3.addActiveFun("up",function(){
			console.log("up");
		});
		
		test3.addTimeFun(function(){
			console.log("haha");
		});
		test3.setDelay(1000);
	</script>
</html>
